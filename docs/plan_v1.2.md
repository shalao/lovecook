# Love Cook v1.2 äº§å“è®¡åˆ’

## ç‰ˆæœ¬ç›®æ ‡

**æ ¸å¿ƒä¸»é¢˜**ï¼šæ‰“é€šå®Œæ•´é—­ç¯ + ç²¾å‡†äººç¾¤æœåŠ¡

```
v1.1: åŸºç¡€åŠŸèƒ½å®Œå–„ï¼ˆå·²å®Œæˆï¼‰
v1.2: æµç¨‹é—­ç¯ + äººç¾¤ç»†åˆ† â† å½“å‰ç‰ˆæœ¬
v1.3: ç¤¾äº¤åˆ†äº« + æ•°æ®æ´å¯Ÿï¼ˆæœªæ¥ï¼‰
```

---

## ä¸€ã€é—®é¢˜æ€»è§ˆ

### 1.1 æµç¨‹æ–­ç‚¹é—®é¢˜

| # | é—®é¢˜ | å½±å“ | ä¼˜å…ˆçº§ |
|---|------|------|--------|
| 0 | é¦–é¡µä¸æ˜¾ç¤ºå·²ç¡®è®¤èœå• | ç”¨æˆ·æ¯æ¬¡æ‰“å¼€éƒ½æ˜¯ç©ºç™½ï¼Œéœ€é‡æ–°ç”Ÿæˆ | ğŸ”´ P0 |
| 1 | ä¿å­˜èœå•åå†å²ä¸åˆ·æ–° | ç”¨æˆ·çœ‹ä¸åˆ°åˆšä¿å­˜çš„èœå• | ğŸ”´ P0 |
| 2 | æ¨èé¡µæ— æ³•ç”Ÿæˆè´­ç‰©æ¸…å• | ç”¨æˆ·æ— æ³•ä¸€é”®ä»æ¨èåˆ°è´­ç‰© | ğŸ”´ P0 |
| 3 | èœå“æ›¿æ¢åè´­ç‰©æ¸…å•ä¸åŒæ­¥ | è´­ç‰©æ¸…å•å¯èƒ½ä¸å‡†ç¡® | ğŸ”´ P0 |
| 3 | æ— æ³•æŒ‡å®šèœå•å¼€å§‹æ—¥æœŸ | æ— æ³•ä¸ºæœªæ¥æ—¥æœŸæå‰è®¡åˆ’ | ğŸŸ¡ P1 |
| 4 | æ— æ³•æŠŠèœè°±æ·»åŠ åˆ°æŒ‡å®šæ—¥æœŸ | çµæ´»æ€§ä¸è¶³ | ğŸŸ¡ P1 |
| 5 | èœå•ä¸è´­ç‰©æ¸…å•ç¼ºå°‘åŒå‘è·³è½¬ | ä½“éªŒå‰²è£‚ | ğŸŸ¢ P2 |

### 1.2 ç”¨æˆ·äººç¾¤éœ€æ±‚

| ç”¨æˆ·ç±»å‹ | ç°æœ‰æ”¯æŒ | éœ€è¦å¢å¼º |
|----------|----------|----------|
| å¥èº«è¾¾äºº | âœ“ å‡è„‚æœŸ/å¢è‚ŒæœŸ | éœ€ç»†åŒ–è®­ç»ƒç±»å‹ + è¥å…»ç›®æ ‡ |
| å­•å¦‡ | âœ“ å­•æœŸ | éœ€åŒºåˆ†å­•æ—©/ä¸­/æ™šæœŸ |
| ç³–å°¿ç—… | âœ“ æ§ç³– | éœ€æ·»åŠ  GI æŒ‡æ•°å‚è€ƒ |
| å‡è‚¥äººç¾¤ | âœ“ å‡è„‚æœŸ | éœ€æ·»åŠ çƒ­é‡ç›®æ ‡ |
| è‚¾ç—…æ‚£è€… | âœ— ç¼ºå¤± | éœ€æ·»åŠ ä½è›‹ç™½/ä½é’¾é€‰é¡¹ |

---

## äºŒã€P0 é«˜ä¼˜å…ˆçº§ï¼šæµç¨‹é—­ç¯

### 2.0 é¦–é¡µæ™ºèƒ½å±•ç¤ºå·²ç¡®è®¤èœå•ï¼ˆæ ¸å¿ƒä½“éªŒï¼‰

**é—®é¢˜**ï¼šç”¨æˆ·æ‰“å¼€ App æ¯æ¬¡éƒ½æ˜¯ç©ºç™½é¡µï¼Œéœ€è¦ç‚¹å‡»"ç”Ÿæˆæ¨è"æ‰èƒ½çœ‹åˆ°å†…å®¹

**æœŸæœ›**ï¼š
- æ‰“å¼€ App ç›´æ¥çœ‹åˆ°å½“å‰æ—¶é—´ç‚¹éœ€è¦åšçš„èœ
- æ¯”å¦‚ç°åœ¨æ˜¯ 1æœˆ26æ—¥ä¸­åˆ 12:00ï¼Œåº”è¯¥æ˜¾ç¤º"ä»Šå¤©åˆé¤"çš„å·²ç¡®è®¤èœå•
- å¦‚æœæ²¡æœ‰å·²ç¡®è®¤çš„èœå•ï¼Œæ‰æ˜¾ç¤º"ç”Ÿæˆæ¨è"ç•Œé¢

**æ–‡ä»¶**ï¼š
- `lib/features/recommend/presentation/screens/recommend_screen.dart`
- `lib/features/recommend/presentation/providers/recommend_provider.dart`

**æ–¹æ¡ˆ**ï¼š

```
æ‰“å¼€ Appï¼ˆæ¨èé¡µï¼‰
       â†“
æ£€æŸ¥æ˜¯å¦æœ‰å·²ä¿å­˜çš„èœå•ï¼ˆå½“å¤©åŠä¹‹åï¼‰
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ‰å·²ç¡®è®¤èœå•                              â”‚
â”‚  â†“                                        â”‚
â”‚  æ ¹æ®å½“å‰æ—¶é—´åˆ¤æ–­é¤æ¬¡                       â”‚
â”‚  â”œâ”€â”€ 6:00-10:00 â†’ é«˜äº®æ˜¾ç¤ºæ—©é¤             â”‚
â”‚  â”œâ”€â”€ 10:00-14:00 â†’ é«˜äº®æ˜¾ç¤ºåˆé¤            â”‚
â”‚  â”œâ”€â”€ 14:00-18:00 â†’ é«˜äº®æ˜¾ç¤ºæ™šé¤å‡†å¤‡         â”‚
â”‚  â””â”€â”€ 18:00+ â†’ é«˜äº®æ˜¾ç¤ºæ™šé¤                 â”‚
â”‚                                           â”‚
â”‚  å±•ç¤ºæ¨¡å¼ï¼š                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“… ä»Šå¤© Â· 1æœˆ26æ—¥                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸŒ… æ—©é¤ âœ“ å·²å®Œæˆ                      â”‚  â”‚
â”‚  â”‚   å°ç±³ç²¥ã€ç…è›‹                        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â˜€ï¸ åˆé¤ â† å½“å‰                        â”‚  â”‚ â† é«˜äº®å½“å‰é¤æ¬¡
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ… ç•ªèŒ„ç‚’è›‹          [å¼€å§‹åš] â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ 15åˆ†é’Ÿ Â· ç®€å• Â· âœ“é£Ÿæé½å…¨     â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ¥¦ æ¸…ç‚’è¥¿å…°èŠ±        [å¼€å§‹åš] â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸŒ™ æ™šé¤                              â”‚  â”‚
â”‚  â”‚   çº¢çƒ§æ’éª¨ã€è’œè“‰è èœ                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚
â”‚  åº•éƒ¨æ“ä½œï¼š                                â”‚
â”‚  [ğŸ“ è°ƒæ•´èœå•] [ğŸ›’ æŸ¥çœ‹è´­ç‰©æ¸…å•] [â• ç”Ÿæˆæ›´å¤š] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ— å·²ç¡®è®¤èœå•                              â”‚
â”‚  â†“                                        â”‚
â”‚  æ˜¾ç¤ºç°æœ‰çš„ç”Ÿæˆæ¨èç•Œé¢                     â”‚
â”‚  - å¤©æ•°é€‰æ‹©                               â”‚
â”‚  - é¤æ¬¡é€‰æ‹©                               â”‚
â”‚  - å¿ƒæƒ…è¾“å…¥                               â”‚
â”‚  - [ç”Ÿæˆæ¨è] æŒ‰é’®                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒé€»è¾‘**ï¼š

```dart
// recommend_provider.dart - åˆå§‹åŒ–æ—¶åŠ è½½å·²ç¡®è®¤èœå•
class RecommendNotifier extends StateNotifier<RecommendState> {
  // æ–°å¢ï¼šå·²ç¡®è®¤çš„èœå•çŠ¶æ€
  MealPlanModel? _confirmedPlan;

  Future<void> initialize() async {
    // åŠ è½½å½“å‰å®¶åº­çš„å·²ä¿å­˜èœå•
    final plan = await _mealPlanRepository.getMealPlanByFamily(_currentFamily?.id);

    if (plan != null && _hasTodayOrFutureMeals(plan)) {
      // æœ‰æœ‰æ•ˆèœå•ï¼Œåˆ‡æ¢åˆ°"å·²ç¡®è®¤æ¨¡å¼"
      _confirmedPlan = plan;
      state = state.copyWith(
        viewMode: RecommendViewMode.confirmed,  // æ–°å¢ï¼šè§†å›¾æ¨¡å¼
        confirmedDayPlans: _extractDayPlans(plan),
        currentMealType: _getCurrentMealType(),  // æ ¹æ®æ—¶é—´åˆ¤æ–­
      );
    } else {
      // æ— æœ‰æ•ˆèœå•ï¼Œæ˜¾ç¤ºç”Ÿæˆç•Œé¢
      state = state.copyWith(
        viewMode: RecommendViewMode.generate,
      );
    }
  }

  /// åˆ¤æ–­å½“å‰åº”è¯¥é«˜äº®çš„é¤æ¬¡
  String _getCurrentMealType() {
    final hour = DateTime.now().hour;
    if (hour >= 6 && hour < 10) return 'breakfast';
    if (hour >= 10 && hour < 14) return 'lunch';
    if (hour >= 14 && hour < 18) return 'dinner'; // å‡†å¤‡æ™šé¤
    return 'dinner';
  }

  /// æ£€æŸ¥èœå•æ˜¯å¦åŒ…å«ä»Šå¤©æˆ–æœªæ¥çš„é¤æ¬¡
  bool _hasTodayOrFutureMeals(MealPlanModel plan) {
    final today = DateTime.now();
    final todayStart = DateTime(today.year, today.month, today.day);
    return plan.days.any((day) =>
      day.date.isAfter(todayStart) ||
      _isSameDay(day.date, todayStart)
    );
  }
}

// recommend_state.dart - æ–°å¢è§†å›¾æ¨¡å¼
enum RecommendViewMode {
  generate,   // ç”Ÿæˆæ¨èæ¨¡å¼ï¼ˆæ— å·²ç¡®è®¤èœå•ï¼‰
  confirmed,  // å·²ç¡®è®¤èœå•æ¨¡å¼ï¼ˆæ˜¾ç¤ºå·²ä¿å­˜çš„èœå•ï¼‰
}

class RecommendState {
  // æ–°å¢å­—æ®µ
  final RecommendViewMode viewMode;
  final List<DayPlan> confirmedDayPlans;  // å·²ç¡®è®¤çš„èœå•
  final String currentMealType;            // å½“å‰é¤æ¬¡
  // ...
}
```

**UI å®ç°**ï¼š

```dart
// recommend_screen.dart
Widget build(BuildContext context) {
  final state = ref.watch(recommendProvider);

  return Scaffold(
    appBar: AppBar(
      title: Text(state.viewMode == RecommendViewMode.confirmed
          ? 'ä»Šæ—¥èœå•'
          : 'ä»Šå¤©åƒä»€ä¹ˆ'),
      actions: [
        if (state.viewMode == RecommendViewMode.confirmed)
          IconButton(
            icon: Icon(Icons.add),
            onPressed: () => _switchToGenerateMode(),
            tooltip: 'ç”Ÿæˆæ›´å¤š',
          ),
        // ...
      ],
    ),
    body: state.viewMode == RecommendViewMode.confirmed
        ? _buildConfirmedView(state)   // å·²ç¡®è®¤èœå•è§†å›¾
        : _buildGenerateView(state),   // ç”Ÿæˆæ¨èè§†å›¾
  );
}

Widget _buildConfirmedView(RecommendState state) {
  return SingleChildScrollView(
    child: Column(
      children: [
        // æ—¥æœŸå¯¼èˆªï¼ˆä»Šå¤©/æ˜å¤©/åå¤©...ï¼‰
        _buildDateNavigator(state),

        // å½“å¤©èœå•
        _buildDayMenuCard(state.confirmedDayPlans.first, state.currentMealType),

        // åº•éƒ¨æ“ä½œæ 
        _buildBottomActions(),
      ],
    ),
  );
}

Widget _buildMealCard(MealModel meal, bool isCurrentMeal) {
  return Container(
    decoration: BoxDecoration(
      border: isCurrentMeal
          ? Border.all(color: Theme.of(context).primaryColor, width: 2)
          : null,
      color: isCurrentMeal
          ? Theme.of(context).primaryColor.withOpacity(0.05)
          : null,
    ),
    child: Column(
      children: [
        // é¤æ¬¡æ ‡é¢˜ + çŠ¶æ€
        Row(
          children: [
            Text(meal.typeName),
            if (isCurrentMeal)
              Chip(label: Text('å½“å‰'), color: primaryColor),
          ],
        ),
        // èœå“åˆ—è¡¨
        ...meal.recipes.map((recipe) => _buildRecipeItem(recipe, isCurrentMeal)),
      ],
    ),
  );
}

Widget _buildRecipeItem(RecipeModel recipe, bool showAction) {
  return ListTile(
    title: Text(recipe.name),
    subtitle: Text('${recipe.totalTime}åˆ†é’Ÿ Â· ${recipe.difficulty}'),
    trailing: showAction
        ? ElevatedButton(
            onPressed: () => _startCooking(recipe),
            child: Text('å¼€å§‹åš'),
          )
        : null,
  );
}
```

**ç”¨æˆ·æµç¨‹**ï¼š

```
åœºæ™¯ 1ï¼šæœ‰å·²ç¡®è®¤èœå•
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç”¨æˆ·æ‰“å¼€ App
    â†“
è‡ªåŠ¨æ˜¾ç¤ºä»Šå¤©çš„èœå•ï¼Œåˆé¤é«˜äº®
    â†“
ç‚¹å‡»"ç•ªèŒ„ç‚’è›‹" â†’ è¿›å…¥èœè°±è¯¦æƒ…
    â†“
ç‚¹å‡»"å¼€å§‹åš" â†’ è¿›å…¥çƒ¹é¥ªæ¨¡å¼
    â†“
å®Œæˆåè¿”å›ï¼Œè¯¥èœå“æ ‡è®°ä¸º"å·²å®Œæˆ"

åœºæ™¯ 2ï¼šæ— å·²ç¡®è®¤èœå•
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç”¨æˆ·æ‰“å¼€ App
    â†“
æ˜¾ç¤ºç”Ÿæˆæ¨èç•Œé¢
    â†“
è®¾ç½®å‚æ•°ï¼Œç‚¹å‡»"ç”Ÿæˆæ¨è"
    â†“
ç¡®è®¤å¹¶ä¿å­˜
    â†“
è‡ªåŠ¨åˆ‡æ¢åˆ°"å·²ç¡®è®¤èœå•"è§†å›¾

åœºæ™¯ 3ï¼šæƒ³è¦è°ƒæ•´èœå•
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç”¨æˆ·åœ¨å·²ç¡®è®¤èœå•è§†å›¾
    â†“
ç‚¹å‡»"è°ƒæ•´èœå•"
    â†“
è¿›å…¥èœå•ç¼–è¾‘æ¨¡å¼ï¼ˆæ›¿æ¢/åˆ é™¤/æ·»åŠ èœå“ï¼‰
    â†“
ä¿å­˜åè¿”å›å·²ç¡®è®¤è§†å›¾
```

**æ—¥æœŸå¯¼èˆªè®¾è®¡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â†] ä»Šå¤© 1/26   æ˜å¤© 1/27   åå¤© 1/28 [â†’] â”‚
â”‚       â—           â—‹           â—‹          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

- æ»‘åŠ¨æˆ–ç‚¹å‡»åˆ‡æ¢æ—¥æœŸ
- å½“å‰æ—¥æœŸä¸‹æ–¹æœ‰åœ†ç‚¹æŒ‡ç¤º
- è¶…å‡ºèœå•èŒƒå›´çš„æ—¥æœŸæ˜¾ç¤º"æ— è®¡åˆ’"
```

**éªŒè¯**ï¼š
- [ ] æ‰“å¼€ App è‡ªåŠ¨æ˜¾ç¤ºå·²ç¡®è®¤èœå•ï¼ˆå¦‚æœæœ‰ï¼‰
- [ ] æ ¹æ®å½“å‰æ—¶é—´é«˜äº®å¯¹åº”é¤æ¬¡
- [ ] æ— èœå•æ—¶æ˜¾ç¤ºç”Ÿæˆæ¨èç•Œé¢
- [ ] å¯ä»¥åœ¨ä¸¤ç§æ¨¡å¼é—´åˆ‡æ¢
- [ ] æ—¥æœŸå¯¼èˆªæ­£å¸¸å·¥ä½œ

---

### 2.1 ä¿å­˜èœå•åå†å²ä¸åˆ·æ–°

**é—®é¢˜**ï¼šç”¨æˆ·åœ¨æ¨èé¡µä¿å­˜èœå•åï¼Œåˆ‡æ¢åˆ°èœå•å†å²é¡µé¢çœ‹ä¸åˆ°åˆšä¿å­˜çš„å†…å®¹

**åŸå› åˆ†æ**ï¼š
- æ¨èé¡µçš„ `saveToHistory()` ä¿å­˜æ•°æ®åˆ° Hive
- ä½†èœå•å†å²é¡µé¢çš„ Provider æ²¡æœ‰æ”¶åˆ°é€šçŸ¥åˆ·æ–°
- Riverpod Provider ä¹‹é—´ç¼ºå°‘æ•°æ®åŒæ­¥æœºåˆ¶

**æ–‡ä»¶**ï¼š
- `lib/features/recommend/presentation/providers/recommend_provider.dart`
- `lib/features/menu/presentation/providers/menu_provider.dart`
- `lib/features/history/presentation/providers/history_provider.dart`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

**æ–¹æ¡ˆ**ï¼š

```dart
// æ–¹æ¡ˆ Aï¼šä½¿ç”¨ Riverpod çš„ invalidate æœºåˆ¶
// recommend_provider.dart - saveToHistory() ç»“æŸæ—¶
Future<bool> saveToHistory() async {
  // ... ä¿å­˜é€»è¾‘ ...

  // é€šçŸ¥å…¶ä»– Provider åˆ·æ–°
  _ref.invalidate(mealPlanListProvider);  // åˆ·æ–°èœå•åˆ—è¡¨
  _ref.invalidate(menuHistoryProvider);   // åˆ·æ–°å†å²è®°å½•

  return true;
}

// æ–¹æ¡ˆ Bï¼šä½¿ç”¨ StreamProvider ç›‘å¬ Hive å˜åŒ–
// meal_plan_repository.dart
Stream<List<MealPlanModel>> watchMealPlans(String familyId) {
  return _box.watch().map((_) => getMealPlansByFamily(familyId));
}

// menu_provider.dart - ä½¿ç”¨ StreamProvider
final mealPlanListProvider = StreamProvider.family<List<MealPlanModel>, String>(
  (ref, familyId) {
    final repository = ref.watch(mealPlanRepositoryProvider);
    return repository.watchMealPlans(familyId);
  },
);
```

**æ¨èæ–¹æ¡ˆ A**ï¼šä½¿ç”¨ `invalidate` æ›´ç®€å•ï¼Œé€‚åˆå½“å‰æ¶æ„

**éªŒè¯**ï¼š
- [ ] æ¨èé¡µä¿å­˜èœå•åï¼Œåˆ‡æ¢åˆ°èœå•é¡µèƒ½çœ‹åˆ°
- [ ] èœå•é¡µç¼–è¾‘åï¼Œæ¨èé¡µä¹Ÿèƒ½çœ‹åˆ°æ›´æ–°
- [ ] åˆ é™¤èœå•åï¼Œå„é¡µé¢åŒæ­¥æ›´æ–°

---

### 2.3 æ¨èé¡µç”Ÿæˆè´­ç‰©æ¸…å•

**é—®é¢˜**ï¼šç”¨æˆ·åœ¨æ¨èé¡µç¡®è®¤èœå•åï¼Œæ²¡æœ‰å…¥å£ç”Ÿæˆè´­ç‰©æ¸…å•

**æ–‡ä»¶**ï¼š
- `lib/features/recommend/presentation/screens/recommend_screen.dart`
- `lib/features/recommend/presentation/providers/recommend_provider.dart`

**æ–¹æ¡ˆ**ï¼š

```
ä¿®æ”¹å‰æµç¨‹ï¼š
æ¨èé¡µ â†’ ä¿å­˜èœå• â†’ ç»“æŸ âŒ

ä¿®æ”¹åæµç¨‹ï¼š
æ¨èé¡µ â†’ ä¿å­˜èœå• â†’ å¼¹å‡ºé€‰é¡¹å¯¹è¯æ¡†
                    â”œâ”€â”€ [æŸ¥çœ‹èœå•] â†’ è·³è½¬èœå•é¡µ
                    â”œâ”€â”€ [ç”Ÿæˆè´­ç‰©æ¸…å•] â†’ ç”Ÿæˆå¹¶è·³è½¬è´­ç‰©é¡µ
                    â””â”€â”€ [ç»§ç»­æµè§ˆ] â†’ ç•™åœ¨æ¨èé¡µ
```

**ä»£ç ä¿®æ”¹**ï¼š

```dart
// recommend_provider.dart - saveToHistory() æ–¹æ³•å¢å¼º
Future<SaveResult> saveToHistory({bool generateShoppingList = false}) async {
  // ... ç°æœ‰ä¿å­˜é€»è¾‘ ...

  String? shoppingListId;
  if (generateShoppingList) {
    // ä»å·²ä¿å­˜çš„èœè°±ä¸­æå–é£Ÿæï¼Œç”Ÿæˆè´­ç‰©æ¸…å•
    final recipes = state.recommendations
        .expand((r) => r.recipes)
        .toList();
    final shoppingList = await _shoppingListRepository.generateFromRecipes(
      recipes: recipes,
      familyId: _currentFamilyId,
      mealPlanId: plan.id,
    );
    shoppingListId = shoppingList.id;

    // æ›´æ–°èœå•å…³è”
    await _mealPlanRepository.updateShoppingListId(plan.id, shoppingListId);
  }

  return SaveResult(
    mealPlanId: plan.id,
    shoppingListId: shoppingListId,
  );
}

// recommend_screen.dart - ä¿å­˜åæ˜¾ç¤ºé€‰é¡¹å¯¹è¯æ¡†
void _showSaveSuccessDialog(SaveResult result) {
  showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: Text('ä¿å­˜æˆåŠŸ'),
      content: Text('èœå•å·²ä¿å­˜ï¼Œæ¥ä¸‹æ¥æ‚¨æƒ³ï¼Ÿ'),
      actions: [
        TextButton(
          onPressed: () {
            Navigator.pop(context);
            context.push(AppRoutes.menu);
          },
          child: Text('æŸ¥çœ‹èœå•'),
        ),
        TextButton(
          onPressed: () async {
            Navigator.pop(context);
            if (result.shoppingListId == null) {
              // å¦‚æœè¿˜æ²¡ç”Ÿæˆï¼Œç°åœ¨ç”Ÿæˆ
              await notifier.generateShoppingListForSavedPlan(result.mealPlanId);
            }
            context.push(AppRoutes.shopping);
          },
          child: Text('ç”Ÿæˆè´­ç‰©æ¸…å•'),
        ),
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('ç»§ç»­æµè§ˆ'),
        ),
      ],
    ),
  );
}
```

**éªŒè¯**ï¼š
- [ ] æ¨èé¡µä¿å­˜åæ˜¾ç¤ºé€‰é¡¹å¯¹è¯æ¡†
- [ ] é€‰æ‹©"ç”Ÿæˆè´­ç‰©æ¸…å•"åè·³è½¬åˆ°è´­ç‰©é¡µ
- [ ] è´­ç‰©æ¸…å•å†…å®¹ä¸æ¨èèœå“é£Ÿæä¸€è‡´

---

### 2.4 èœå“æ›¿æ¢åŒæ­¥è´­ç‰©æ¸…å•

**é—®é¢˜**ï¼šåœ¨èœå•è¯¦æƒ…ä¸­æ›¿æ¢æˆ–åˆ é™¤èœå“åï¼Œè´­ç‰©æ¸…å•ä¸ä¼šæ›´æ–°

**æ–‡ä»¶**ï¼š
- `lib/features/menu/presentation/screens/menu_screen.dart`
- `lib/features/shopping/data/repositories/shopping_list_repository.dart`

**æ–¹æ¡ˆ**ï¼š

```
ä¿®æ”¹å‰ï¼š
æ›¿æ¢èœå“ â†’ æ›´æ–°èœå• â†’ ç»“æŸï¼ˆè´­ç‰©æ¸…å•è¿‡æ—¶ï¼‰âŒ

ä¿®æ”¹åï¼š
æ›¿æ¢èœå“ â†’ æ›´æ–°èœå• â†’ æ£€æŸ¥æ˜¯å¦æœ‰å…³è”è´­ç‰©æ¸…å•
                      â”œâ”€â”€ æœ‰ â†’ é‡æ–°ç”Ÿæˆè´­ç‰©æ¸…å•
                      â””â”€â”€ æ—  â†’ ç»“æŸ
```

**ä»£ç ä¿®æ”¹**ï¼š

```dart
// shopping_list_repository.dart - æ–°å¢æ–¹æ³•
Future<void> regenerateFromMealPlan(String mealPlanId) async {
  final mealPlan = await _mealPlanRepository.getMealPlanById(mealPlanId);
  if (mealPlan == null || mealPlan.shoppingListId == null) return;

  // è·å–èœå•ä¸­æ‰€æœ‰èœè°±
  final recipes = <RecipeModel>[];
  for (final day in mealPlan.days) {
    for (final meal in day.meals) {
      recipes.addAll(meal.recipes);
    }
  }

  // é‡æ–°ç”Ÿæˆè´­ç‰©æ¸…å•
  final newItems = _generateItemsFromRecipes(recipes);

  // æ›´æ–°è´­ç‰©æ¸…å•ï¼ˆä¿ç•™å·²è´­ä¹°çŠ¶æ€ï¼‰
  await _updateShoppingListItems(mealPlan.shoppingListId!, newItems);
}

// menu_screen.dart - æ›¿æ¢èœå“ååŒæ­¥
Future<void> _replaceRecipe(...) async {
  await repository.replaceRecipeInMeal(...);

  // åŒæ­¥è´­ç‰©æ¸…å•
  if (widget.plan.shoppingListId != null) {
    await shoppingListRepository.regenerateFromMealPlan(widget.plan.id);
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('è´­ç‰©æ¸…å•å·²åŒæ­¥æ›´æ–°')),
    );
  }
}
```

**éªŒè¯**ï¼š
- [ ] æ›¿æ¢èœå“åè´­ç‰©æ¸…å•è‡ªåŠ¨æ›´æ–°
- [ ] åˆ é™¤èœå“åè´­ç‰©æ¸…å•ç§»é™¤å¯¹åº”é£Ÿæ
- [ ] å·²è´­ä¹°çš„é¡¹ç›®çŠ¶æ€ä¿ç•™

---

## ä¸‰ã€P1 ä¸­ä¼˜å…ˆçº§ï¼šæ—¥æœŸç®¡ç†

### 3.1 æŒ‡å®šèœå•å¼€å§‹æ—¥æœŸ

**é—®é¢˜**ï¼šèœå•ç”Ÿæˆå§‹ç»ˆä»"ä»Šå¤©"å¼€å§‹ï¼Œæ— æ³•ä¸ºæœªæ¥æ—¥æœŸè®¡åˆ’

**æ–‡ä»¶**ï¼š
- `lib/features/menu/presentation/screens/generate_menu_screen.dart`
- `lib/features/menu/presentation/providers/menu_provider.dart`

**æ–¹æ¡ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆèœå•                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼€å§‹æ—¥æœŸï¼š[ä»Šå¤© â–¼]                  â”‚  â† æ–°å¢æ—¥æœŸé€‰æ‹©
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚           â”‚ < 2024å¹´1æœˆ     â”‚       â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚           â”‚ æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­ â”‚  â”‚
â”‚           â”‚ .. .. .. 1  2  3  4  â”‚  â”‚
â”‚           â”‚ 5  6  7  8  9  10 11 â”‚  â”‚
â”‚           â”‚ ...                  â”‚  â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                     â”‚
â”‚ ç”Ÿæˆå¤©æ•°ï¼š[3å¤©] [5å¤©] [7å¤©]         â”‚
â”‚ æ¯é¤èœå“ï¼š[1é“] [2é“] [3é“]         â”‚
â”‚                                     â”‚
â”‚ [å¼€å§‹ç”Ÿæˆ]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç ä¿®æ”¹**ï¼š

```dart
// menu_provider.dart - MenuGenerateState æ·»åŠ å­—æ®µ
class MenuGenerateState {
  // ... ç°æœ‰å­—æ®µ ...
  final DateTime startDate;  // æ–°å¢ï¼šèœå•å¼€å§‹æ—¥æœŸ

  MenuGenerateState({
    // ...
    DateTime? startDate,
  }) : startDate = startDate ?? DateTime.now();
}

// menu_provider.dart - saveMenuPlan() ä½¿ç”¨ startDate
Future<void> saveMenuPlan(...) async {
  final startDate = state.startDate;  // ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„æ—¥æœŸ
  for (var i = 0; i < state.result!.days.length; i++) {
    final date = DateTime(startDate.year, startDate.month, startDate.day)
        .add(Duration(days: i));
    // ...
  }
}

// generate_menu_screen.dart - æ·»åŠ æ—¥æœŸé€‰æ‹©å™¨
Widget _buildStartDateSelector() {
  return ListTile(
    title: Text('å¼€å§‹æ—¥æœŸ'),
    subtitle: Text(DateFormat('yyyyå¹´Mæœˆdæ—¥ EEEE', 'zh_CN').format(state.startDate)),
    trailing: Icon(Icons.calendar_today),
    onTap: () async {
      final date = await showDatePicker(
        context: context,
        initialDate: state.startDate,
        firstDate: DateTime.now(),
        lastDate: DateTime.now().add(Duration(days: 30)),
      );
      if (date != null) {
        notifier.setStartDate(date);
      }
    },
  );
}
```

**éªŒè¯**ï¼š
- [ ] å¯ä»¥é€‰æ‹©æœªæ¥30å¤©å†…ä»»æ„æ—¥æœŸä½œä¸ºå¼€å§‹æ—¥æœŸ
- [ ] ç”Ÿæˆçš„èœå•ä»é€‰æ‹©çš„æ—¥æœŸå¼€å§‹
- [ ] èœå•åˆå¹¶æ—¶æ­£ç¡®å¤„ç†æ—¥æœŸèŒƒå›´

---

### 3.2 æ·»åŠ èœè°±åˆ°æŒ‡å®šæ—¥æœŸ

**é—®é¢˜**ï¼šç”Ÿæˆçš„èœè°±æ— æ³•æ·»åŠ åˆ°å…¶ä»–æ—¥æœŸ

**æ–‡ä»¶**ï¼š
- `lib/features/recipe/presentation/screens/recipe_detail_screen.dart`
- `lib/features/menu/data/repositories/meal_plan_repository.dart`

**æ–¹æ¡ˆ**ï¼š

```
èœè°±è¯¦æƒ…é¡µ â†’ ç‚¹å‡»"æ·»åŠ åˆ°èœå•"æŒ‰é’®
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ·»åŠ åˆ°èœå•                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹©æ—¥æœŸï¼š                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ä»Šå¤© â”‚ â”‚ æ˜å¤© â”‚ â”‚ åå¤© â”‚ â”‚ æ›´å¤š â”‚   â”‚
â”‚ â”‚ 1/26 â”‚ â”‚ 1/27 â”‚ â”‚ 1/28 â”‚ â”‚ ... â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚ é€‰æ‹©é¤æ¬¡ï¼š                          â”‚
â”‚ â—‹ æ—©é¤  â— åˆé¤  â—‹ æ™šé¤              â”‚
â”‚                                     â”‚
â”‚ [å–æ¶ˆ]                    [ç¡®è®¤æ·»åŠ ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç ä¿®æ”¹**ï¼š

```dart
// recipe_detail_screen.dart - æ·»åŠ åˆ°èœå•æŒ‰é’®
Widget _buildAddToMenuButton() {
  return ElevatedButton.icon(
    icon: Icon(Icons.calendar_month),
    label: Text('æ·»åŠ åˆ°èœå•'),
    onPressed: () => _showAddToMenuDialog(),
  );
}

void _showAddToMenuDialog() {
  showModalBottomSheet(
    context: context,
    builder: (context) => AddToMenuSheet(
      recipe: widget.recipe,
      onConfirm: (date, mealType) async {
        await mealPlanRepository.addRecipeToDate(
          familyId: currentFamilyId,
          date: date,
          mealType: mealType,
          recipe: widget.recipe,
        );
        Navigator.pop(context);
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('å·²æ·»åŠ åˆ° ${DateFormat('Mæœˆdæ—¥').format(date)} $mealType')),
        );
      },
    ),
  );
}

// meal_plan_repository.dart - æ–°å¢æ–¹æ³•
Future<void> addRecipeToDate({
  required String familyId,
  required DateTime date,
  required String mealType,
  required RecipeModel recipe,
}) async {
  // è·å–æˆ–åˆ›å»ºè¯¥å®¶åº­çš„èœå•
  var plan = await getMealPlanByFamily(familyId);
  if (plan == null) {
    plan = MealPlanModel.create(familyId: familyId, startDate: date);
  }

  // æŸ¥æ‰¾æˆ–åˆ›å»ºè¯¥æ—¥æœŸçš„è®¡åˆ’
  var dayPlan = plan.days.firstWhereOrNull(
    (d) => _isSameDay(d.date, date),
  );
  if (dayPlan == null) {
    dayPlan = DayPlanModel(date: date, meals: []);
    // æ‰©å±•æ—¥æœŸèŒƒå›´...
  }

  // æ·»åŠ èœå“åˆ°å¯¹åº”é¤æ¬¡
  var meal = dayPlan.meals.firstWhereOrNull((m) => m.type == mealType);
  if (meal == null) {
    meal = MealModel(type: mealType, recipes: []);
    dayPlan.meals.add(meal);
  }
  meal.recipes.add(recipe);

  await saveMealPlan(plan);
}
```

**éªŒè¯**ï¼š
- [ ] èœè°±è¯¦æƒ…é¡µæ˜¾ç¤º"æ·»åŠ åˆ°èœå•"æŒ‰é’®
- [ ] å¯ä»¥é€‰æ‹©æ—¥æœŸå’Œé¤æ¬¡
- [ ] æ·»åŠ æˆåŠŸåèœå•ä¸­æ˜¾ç¤ºè¯¥èœå“

---

## å››ã€P1 ä¸­ä¼˜å…ˆçº§ï¼šäººç¾¤ç»†åˆ†

### 4.1 å¥èº«è¾¾äººç»†åˆ†

**å½“å‰**ï¼šåªæœ‰"å‡è„‚æœŸ"å’Œ"å¢è‚ŒæœŸ"ä¸¤ä¸ªé€‰é¡¹

**å¢å¼º**ï¼š

```dart
// dietary_options.dart - æ–°å¢é€‰é¡¹
const fitnessGoalOptions = [
  // å‡è„‚ç±»
  'å‡è„‚-è½»åº¦ï¼ˆæ¯å‘¨å‡0.5kgï¼‰',
  'å‡è„‚-ä¸­åº¦ï¼ˆæ¯å‘¨å‡1kgï¼‰',
  'å‡è„‚-æé€Ÿï¼ˆæ¯å‘¨å‡1.5kgï¼‰',

  // å¢è‚Œç±»
  'å¢è‚Œ-æ–°æ‰‹ï¼ˆè›‹ç™½è´¨1.6g/kgï¼‰',
  'å¢è‚Œ-è¿›é˜¶ï¼ˆè›‹ç™½è´¨2.0g/kgï¼‰',
  'å¢è‚Œ-ä¸“ä¸šï¼ˆè›‹ç™½è´¨2.2g/kgï¼‰',

  // ç»´æŒç±»
  'ç»´æŒä½“é‡',
  'æå‡è€åŠ›',
];

// æ–°å¢è¥å…»ç›®æ ‡è®¾ç½®
const nutritionTargets = {
  'å‡è„‚-è½»åº¦': NutritionTarget(
    calorieDeficit: 500,
    proteinRatio: 0.30,
    carbRatio: 0.40,
    fatRatio: 0.30,
  ),
  'å¢è‚Œ-æ–°æ‰‹': NutritionTarget(
    calorieSurplus: 300,
    proteinRatio: 0.30,
    carbRatio: 0.50,
    fatRatio: 0.20,
  ),
  // ...
};
```

**UI å¢å¼º**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¥èº«ç›®æ ‡è®¾ç½®                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç›®æ ‡ç±»å‹ï¼š                          â”‚
â”‚ [å‡è„‚] [å¢è‚Œ] [ç»´æŒ]                â”‚
â”‚                                     â”‚
â”‚ ç›®æ ‡å¼ºåº¦ï¼š                          â”‚
â”‚ â—‹ è½»åº¦  â— ä¸­åº¦  â—‹ æé€Ÿ              â”‚
â”‚                                     â”‚
â”‚ è¥å…»æ¯”ä¾‹ï¼šï¼ˆå¯é€‰ï¼Œé«˜çº§è®¾ç½®ï¼‰        â”‚
â”‚ è›‹ç™½è´¨ï¼š[30%]  ç¢³æ°´ï¼š[40%]  è„‚è‚ªï¼š[30%] â”‚
â”‚                                     â”‚
â”‚ æ¯æ—¥çƒ­é‡ç›®æ ‡ï¼šçº¦ 1800 kcal          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.2 å­•æœŸç»†åˆ†

**å½“å‰**ï¼šåªæœ‰"å­•æœŸ"ä¸€ä¸ªé€‰é¡¹

**å¢å¼º**ï¼š

```dart
// dietary_options.dart - å­•æœŸç»†åˆ†
const pregnancyStageOptions = [
  'å¤‡å­•æœŸ',
  'å­•æ—©æœŸï¼ˆ1-12å‘¨ï¼‰',
  'å­•ä¸­æœŸï¼ˆ13-27å‘¨ï¼‰',
  'å­•æ™šæœŸï¼ˆ28-40å‘¨ï¼‰',
  'å“ºä¹³æœŸ',
];

// å„é˜¶æ®µè¥å…»é‡ç‚¹
const pregnancyNutritionFocus = {
  'å¤‡å­•æœŸ': ['å¶é…¸', 'é“', 'é”Œ'],
  'å­•æ—©æœŸï¼ˆ1-12å‘¨ï¼‰': ['å¶é…¸', 'ç»´ç”Ÿç´ B6', 'æ¸…æ·¡æ˜“æ¶ˆåŒ–'],
  'å­•ä¸­æœŸï¼ˆ13-27å‘¨ï¼‰': ['é’™', 'é“', 'DHA', 'è›‹ç™½è´¨'],
  'å­•æ™šæœŸï¼ˆ28-40å‘¨ï¼‰': ['é’™', 'é“', 'è†³é£Ÿçº¤ç»´', 'æ§åˆ¶ä½“é‡'],
  'å“ºä¹³æœŸ': ['é’™', 'è›‹ç™½è´¨', 'æ°´åˆ†', 'å‚¬ä¹³é£Ÿæ'],
};
```

---

### 4.3 æ–°å¢ç‰¹æ®Šäººç¾¤

```dart
// dietary_options.dart - æ–°å¢å¥åº·çŠ¶å†µ
const healthConditionOptions = [
  // ç°æœ‰é€‰é¡¹...

  // æ–°å¢è‚¾è„ç–¾ç—…
  'è‚¾è„ç–¾ç—…-è½»åº¦ï¼ˆä½ç›ï¼‰',
  'è‚¾è„ç–¾ç—…-ä¸­åº¦ï¼ˆä½è›‹ç™½ï¼‰',
  'è‚¾è„ç–¾ç—…-é€ææœŸ',

  // æ–°å¢æ¶ˆåŒ–ç³»ç»Ÿ
  'èƒƒç‚/èƒƒæºƒç–¡',
  'è‚ æ˜“æ¿€ç»¼åˆå¾(IBS)',
  'ä¹³ç³–ä¸è€å—',

  // æ–°å¢å…¶ä»–
  'ç—›é£ï¼ˆä½å˜Œå‘¤ï¼‰',
  'ç”²çŠ¶è…ºé—®é¢˜',
  'è´«è¡€ï¼ˆè¡¥é“è¡¥è¡€ï¼‰',
];

// å¯¹åº”çš„é¥®é£Ÿå»ºè®®
const healthDietaryGuidelines = {
  'è‚¾è„ç–¾ç—…-ä¸­åº¦ï¼ˆä½è›‹ç™½ï¼‰': DietaryGuideline(
    avoid: ['é«˜è›‹ç™½é£Ÿç‰©', 'é«˜é’¾é£Ÿç‰©', 'é«˜ç£·é£Ÿç‰©'],
    recommend: ['ä½è›‹ç™½ä¸»é£Ÿ', 'æ–°é²œè”¬èœ'],
    dailyProteinLimit: 40, // å…‹
    dailySodiumLimit: 2000, // æ¯«å…‹
  ),
  'ç—›é£ï¼ˆä½å˜Œå‘¤ï¼‰': DietaryGuideline(
    avoid: ['æµ·é²œ', 'å†…è„', 'çº¢è‚‰', 'å•¤é…’', 'æµ“æ±¤'],
    recommend: ['ä½è„‚å¥¶', 'é¸¡è›‹', 'è”¬èœ', 'æ°´æœ'],
  ),
  // ...
};
```

---

### 4.4 AI Prompt å¢å¼º

```dart
// ai_service.dart - å¢å¼ºå®¶åº­ä¿¡æ¯æ„å»º
String _buildFamilyInfo(FamilyModel family) {
  final buffer = StringBuffer();
  buffer.writeln('å®¶åº­åç§°ï¼š${family.name}');
  buffer.writeln('æˆå‘˜ï¼ˆ${family.members.length}äººï¼‰ï¼š');

  for (final member in family.members) {
    buffer.write('- ${member.name}');
    if (member.age != null) {
      buffer.write('ï¼ˆ${member.age}å²ï¼Œ${member.ageGroup}ï¼‰');
    }

    // å¥åº·çŠ¶å†µè¯¦æƒ…
    if (member.healthConditions.isNotEmpty) {
      buffer.write('\n  å¥åº·å…³æ³¨ï¼š${member.healthConditions.join("ã€")}');

      // æ·»åŠ å…·ä½“è¥å…»å»ºè®®
      for (final condition in member.healthConditions) {
        final guideline = healthDietaryGuidelines[condition];
        if (guideline != null) {
          if (guideline.avoid.isNotEmpty) {
            buffer.write('\n  éœ€é¿å…ï¼š${guideline.avoid.join("ã€")}');
          }
          if (guideline.recommend.isNotEmpty) {
            buffer.write('\n  æ¨èï¼š${guideline.recommend.join("ã€")}');
          }
          if (guideline.dailyProteinLimit != null) {
            buffer.write('\n  æ¯æ—¥è›‹ç™½è´¨é™åˆ¶ï¼š${guideline.dailyProteinLimit}g');
          }
        }
      }
    }

    // è¿‡æ•å’Œç¦å¿Œ
    if (member.allergies.isNotEmpty) {
      buffer.write('\n  è¿‡æ•ï¼š${member.allergies.join("ã€")}ã€ä¸¥æ ¼é¿å…ã€‘');
    }
    if (member.dislikes.isNotEmpty) {
      buffer.write('\n  å¿Œå£ï¼š${member.dislikes.join("ã€")}');
    }

    buffer.writeln();
  }

  return buffer.toString();
}
```

---

## äº”ã€P2 ä½ä¼˜å…ˆçº§ï¼šä½“éªŒä¼˜åŒ–

### 5.1 èœå•ä¸è´­ç‰©æ¸…å•åŒå‘è·³è½¬

```dart
// menu_screen.dart - èœå•è¯¦æƒ…æ·»åŠ è´­ç‰©æ¸…å•å…¥å£
Widget _buildShoppingListLink() {
  if (widget.plan.shoppingListId == null) {
    return TextButton.icon(
      icon: Icon(Icons.shopping_cart_outlined),
      label: Text('ç”Ÿæˆè´­ç‰©æ¸…å•'),
      onPressed: () => _generateShoppingList(),
    );
  }
  return TextButton.icon(
    icon: Icon(Icons.shopping_cart),
    label: Text('æŸ¥çœ‹è´­ç‰©æ¸…å•'),
    onPressed: () => context.push('${AppRoutes.shopping}/${widget.plan.shoppingListId}'),
  );
}

// shopping_list_screen.dart - è´­ç‰©æ¸…å•æ·»åŠ èœå•å…¥å£
Widget _buildMealPlanLink() {
  if (shoppingList.mealPlanId == null) return SizedBox.shrink();
  return TextButton.icon(
    icon: Icon(Icons.restaurant_menu),
    label: Text('æŸ¥çœ‹å…³è”èœå•'),
    onPressed: () => context.push('${AppRoutes.menu}/${shoppingList.mealPlanId}'),
  );
}
```

### 5.2 è´­ç‰©æ¸…å•æ™ºèƒ½æç¤º

```dart
// shopping_list_screen.dart - æ˜¾ç¤ºåº“å­˜æç¤º
Widget _buildShoppingItem(ShoppingItemModel item) {
  final inventoryItem = inventory.findByName(item.name);

  return ListTile(
    leading: Checkbox(
      value: item.purchased,
      onChanged: (v) => _togglePurchased(item),
    ),
    title: Text(item.name),
    subtitle: inventoryItem != null
        ? Text('å®¶é‡Œè¿˜æœ‰ ${inventoryItem.quantity}${inventoryItem.unit}',
            style: TextStyle(color: Colors.green))
        : null,
    trailing: Text('${item.quantity}${item.unit}'),
  );
}
```

---

## å…­ã€è¯¦ç»†å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šé¦–é¡µæ™ºèƒ½å±•ç¤ºï¼ˆP0-æ ¸å¿ƒï¼‰

```
ç›®æ ‡ï¼šæ‰“å¼€ App ç›´æ¥çœ‹åˆ°å½“å‰éœ€è¦åšçš„èœ
é¢„è®¡ï¼š3-4 å¤©
```

#### Step 1.1ï¼šæ•°æ®å±‚å‡†å¤‡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.1.1 RecommendState æ·»åŠ å­—æ®µ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_provider.dart                                â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢ï¼š                                                       â”‚
â”‚ - viewMode: RecommendViewMode (generate/confirmed)          â”‚
â”‚ - confirmedPlan: MealPlanModel?                             â”‚
â”‚ - currentMealType: String (breakfast/lunch/dinner)          â”‚
â”‚ - selectedDate: DateTime                                    â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šç¼–è¯‘é€šè¿‡ï¼Œæ— æŠ¥é”™                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.1.2 RecommendNotifier æ·»åŠ åˆå§‹åŒ–é€»è¾‘                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_provider.dart                                â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢æ–¹æ³•ï¼š                                                   â”‚
â”‚ - initialize() â†’ åŠ è½½å·²ä¿å­˜èœå•                              â”‚
â”‚ - _loadConfirmedPlan() â†’ ä» MealPlanRepository è·å–          â”‚
â”‚ - _getCurrentMealType() â†’ æ ¹æ®æ—¶é—´åˆ¤æ–­é¤æ¬¡                   â”‚
â”‚ - _hasTodayOrFutureMeals() â†’ æ£€æŸ¥èœå•æœ‰æ•ˆæ€§                  â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šæ‰“å°æ—¥å¿—ç¡®è®¤åŠ è½½é€»è¾‘æ­£ç¡®                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.1.3 Provider åˆå§‹åŒ–æ—¶æœº                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_provider.dart                                â”‚
â”‚                                                             â”‚
â”‚ ä¿®æ”¹ recommendProvider å®šä¹‰ï¼š                                â”‚
â”‚ - åœ¨ Provider åˆ›å»ºæ—¶è°ƒç”¨ initialize()                        â”‚
â”‚ - æˆ–åœ¨ RecommendScreen initState ä¸­è§¦å‘                      â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šApp å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½å·²ç¡®è®¤èœå•                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 1.2ï¼šUI å±‚å®ç°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.2.1 è§†å›¾æ¨¡å¼åˆ‡æ¢                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_screen.dart                                  â”‚
â”‚                                                             â”‚
â”‚ ä¿®æ”¹ build() æ–¹æ³•ï¼š                                          â”‚
â”‚ if (state.viewMode == confirmed)                            â”‚
â”‚   â†’ _buildConfirmedView()                                   â”‚
â”‚ else                                                        â”‚
â”‚   â†’ _buildGenerateView() (ç°æœ‰é€»è¾‘)                          â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šä¸¤ç§æ¨¡å¼å¯ä»¥åˆ‡æ¢æ˜¾ç¤º                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.2.2 å·²ç¡®è®¤èœå•è§†å›¾éª¨æ¶                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_screen.dart                                  â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢ _buildConfirmedView()ï¼š                                 â”‚
â”‚ â”œâ”€â”€ _buildDateHeader()     â†’ æ—¥æœŸæ ‡é¢˜                        â”‚
â”‚ â”œâ”€â”€ _buildMealSection()    â†’ æ—©/åˆ/æ™šé¤åŒºå—                  â”‚
â”‚ â””â”€â”€ _buildBottomActions()  â†’ åº•éƒ¨æ“ä½œæ                       â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šåŸºæœ¬å¸ƒå±€æ˜¾ç¤ºæ­£ç¡®                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.2.3 å½“å‰é¤æ¬¡é«˜äº®                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_screen.dart                                  â”‚
â”‚                                                             â”‚
â”‚ ä¿®æ”¹ _buildMealSection()ï¼š                                   â”‚
â”‚ - åˆ¤æ–­ isCurrentMeal = (meal.type == state.currentMealType)  â”‚
â”‚ - é«˜äº®æ ·å¼ï¼šè¾¹æ¡†ã€èƒŒæ™¯è‰²ã€"å½“å‰"æ ‡ç­¾                          â”‚
â”‚ - æ˜¾ç¤º"å¼€å§‹åš"æŒ‰é’®                                           â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šå½“å‰é¤æ¬¡æœ‰æ˜æ˜¾è§†è§‰åŒºåˆ†                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.2.4 æ—¥æœŸå¯¼èˆªç»„ä»¶                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_screen.dart                                  â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢ _buildDateNavigator()ï¼š                                 â”‚
â”‚ â”œâ”€â”€ æ¨ªå‘æ»šåŠ¨æ—¥æœŸåˆ—è¡¨ï¼ˆä»Šå¤©/æ˜å¤©/åå¤©...ï¼‰                     â”‚
â”‚ â”œâ”€â”€ å½“å‰é€‰ä¸­æ—¥æœŸæŒ‡ç¤ºå™¨                                       â”‚
â”‚ â”œâ”€â”€ ç‚¹å‡»åˆ‡æ¢ selectedDate                                   â”‚
â”‚ â””â”€â”€ è¶…å‡ºèœå•èŒƒå›´æ˜¾ç¤º"æ— è®¡åˆ’"                                 â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šå¯ä»¥åˆ‡æ¢æ—¥æœŸæŸ¥çœ‹ä¸åŒå¤©çš„èœå•                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.2.5 åº•éƒ¨æ“ä½œæ                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_screen.dart                                  â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢ _buildBottomActions()ï¼š                                 â”‚
â”‚ â”œâ”€â”€ [è°ƒæ•´èœå•] â†’ è¿›å…¥èœå•ç¼–è¾‘æ¨¡å¼                            â”‚
â”‚ â”œâ”€â”€ [è´­ç‰©æ¸…å•] â†’ è·³è½¬è´­ç‰©æ¸…å•é¡µ                              â”‚
â”‚ â””â”€â”€ [ç”Ÿæˆæ›´å¤š] â†’ åˆ‡æ¢åˆ°ç”Ÿæˆæ¨¡å¼                              â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šä¸‰ä¸ªæŒ‰é’®éƒ½èƒ½æ­£ç¡®å“åº”                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 1.3ï¼šæ¨¡å¼åˆ‡æ¢ä¸è”åŠ¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.3.1 ç”Ÿæˆåè‡ªåŠ¨åˆ‡æ¢åˆ°å·²ç¡®è®¤æ¨¡å¼                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_provider.dart, recommend_screen.dart         â”‚
â”‚                                                             â”‚
â”‚ ä¿®æ”¹ saveToHistory()ï¼š                                       â”‚
â”‚ - ä¿å­˜æˆåŠŸåæ›´æ–° viewMode = confirmed                        â”‚
â”‚ - æ›´æ–° confirmedPlan                                        â”‚
â”‚ - æ›´æ–° currentMealType                                      â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šç”Ÿæˆå¹¶ä¿å­˜åè‡ªåŠ¨æ˜¾ç¤ºå·²ç¡®è®¤è§†å›¾                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.3.2 AppBar æ ‡é¢˜å’Œæ“ä½œæŒ‰é’®é€‚é…                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_screen.dart                                  â”‚
â”‚                                                             â”‚
â”‚ ä¿®æ”¹ AppBarï¼š                                                â”‚
â”‚ - confirmed æ¨¡å¼ï¼šæ ‡é¢˜"ä»Šæ—¥èœå•"ï¼Œactions æ·»åŠ "+"æŒ‰é’®        â”‚
â”‚ - generate æ¨¡å¼ï¼šæ ‡é¢˜"ä»Šå¤©åƒä»€ä¹ˆ"ï¼Œä¿æŒç°æœ‰ actions          â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šä¸¤ç§æ¨¡å¼ AppBar æ˜¾ç¤ºæ­£ç¡®                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### é˜¶æ®µäºŒï¼šæ•°æ®åŒæ­¥åˆ·æ–°ï¼ˆP0ï¼‰

```
ç›®æ ‡ï¼šä¿å­˜åå„é¡µé¢æ•°æ®è‡ªåŠ¨åˆ·æ–°
é¢„è®¡ï¼š1 å¤©
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2.1 saveToHistory æ·»åŠ  invalidate è°ƒç”¨                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_provider.dart                                â”‚
â”‚                                                             â”‚
â”‚ åœ¨ saveToHistory() æœ«å°¾æ·»åŠ ï¼š                                â”‚
â”‚ - ref.invalidate(mealPlanListProvider)                      â”‚
â”‚ - ref.invalidate(familyMealPlanProvider)                    â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šæ¨èé¡µä¿å­˜ â†’ èœå•é¡µè‡ªåŠ¨åˆ·æ–°æ˜¾ç¤º                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2.2 èœå•é¡µç¼–è¾‘ååˆ·æ–°æ¨èé¡µ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šmenu_screen.dart, menu_provider.dart                   â”‚
â”‚                                                             â”‚
â”‚ åœ¨æ›¿æ¢/åˆ é™¤èœå“åï¼š                                          â”‚
â”‚ - ref.invalidate(recommendProvider)                         â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šèœå•é¡µç¼–è¾‘ â†’ æ¨èé¡µè‡ªåŠ¨åˆ·æ–°                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2.3 ç¡®ä¿ Provider æ­£ç¡®è·å– ref                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_provider.dart                                â”‚
â”‚                                                             â”‚
â”‚ æ£€æŸ¥ RecommendNotifier æ„é€ å‡½æ•°ï¼š                            â”‚
â”‚ - ç¡®ä¿ä¼ å…¥ Ref å‚æ•°                                          â”‚
â”‚ - ä¿å­˜ä¸º _ref æˆå‘˜å˜é‡                                       â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šinvalidate è°ƒç”¨ä¸æŠ¥é”™                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### é˜¶æ®µä¸‰ï¼šæ¨èâ†’è´­ç‰©æ¸…å•ï¼ˆP0ï¼‰

```
ç›®æ ‡ï¼šæ¨èé¡µå¯ç›´æ¥ç”Ÿæˆè´­ç‰©æ¸…å•
é¢„è®¡ï¼š1-2 å¤©
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.1 saveToHistory è¿”å›ç»“æœå¯¹è±¡                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_provider.dart                                â”‚
â”‚                                                             â”‚
â”‚ ä¿®æ”¹è¿”å›ç±»å‹ï¼š                                               â”‚
â”‚ Future<bool> â†’ Future<SaveResult>                           â”‚
â”‚                                                             â”‚
â”‚ SaveResult {                                                â”‚
â”‚   bool success;                                             â”‚
â”‚   String? mealPlanId;                                       â”‚
â”‚   String? shoppingListId;                                   â”‚
â”‚ }                                                           â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šç¼–è¯‘é€šè¿‡                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.2 æ·»åŠ è´­ç‰©æ¸…å•ç”Ÿæˆé€»è¾‘                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_provider.dart                                â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢å‚æ•°ï¼šsaveToHistory({generateShoppingList: false})       â”‚
â”‚                                                             â”‚
â”‚ å½“ generateShoppingList = true æ—¶ï¼š                         â”‚
â”‚ 1. æ”¶é›†æ‰€æœ‰èœè°±çš„é£Ÿæ                                        â”‚
â”‚ 2. è°ƒç”¨ ShoppingListRepository.generateFromRecipes()        â”‚
â”‚ 3. å…³è” mealPlanId                                          â”‚
â”‚ 4. è¿”å› shoppingListId                                      â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šè´­ç‰©æ¸…å•æ­£ç¡®ç”Ÿæˆå¹¶å…³è”                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.3 ä¿å­˜æˆåŠŸå¯¹è¯æ¡†                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecommend_screen.dart                                  â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢ _showSaveSuccessDialog()ï¼š                              â”‚
â”‚ â”œâ”€â”€ [æŸ¥çœ‹èœå•] â†’ context.push(AppRoutes.menu)                â”‚
â”‚ â”œâ”€â”€ [ç”Ÿæˆè´­ç‰©æ¸…å•] â†’ ç”Ÿæˆå¹¶è·³è½¬                              â”‚
â”‚ â””â”€â”€ [ç»§ç»­æµè§ˆ] â†’ å…³é—­å¯¹è¯æ¡†                                  â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šä¿å­˜åå¼¹å‡ºé€‰é¡¹å¯¹è¯æ¡†                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### é˜¶æ®µå››ï¼šèœå“æ›¿æ¢åŒæ­¥è´­ç‰©æ¸…å•ï¼ˆP0ï¼‰

```
ç›®æ ‡ï¼šæ›¿æ¢èœå“åè´­ç‰©æ¸…å•è‡ªåŠ¨æ›´æ–°
é¢„è®¡ï¼š1 å¤©
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4.1 ShoppingListRepository æ·»åŠ é‡æ–°ç”Ÿæˆæ–¹æ³•                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šshopping_list_repository.dart                          â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢æ–¹æ³•ï¼š                                                   â”‚
â”‚ regenerateFromMealPlan(String mealPlanId) async {           â”‚
â”‚   1. è·å– mealPlan                                          â”‚
â”‚   2. æå–æ‰€æœ‰èœè°±é£Ÿæ                                        â”‚
â”‚   3. åˆå¹¶ç›¸åŒé£Ÿæ                                            â”‚
â”‚   4. ä¿ç•™å·²è´­ä¹°çŠ¶æ€                                          â”‚
â”‚   5. æ›´æ–°è´­ç‰©æ¸…å•                                            â”‚
â”‚ }                                                           â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šå•å…ƒæµ‹è¯•é€šè¿‡                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4.2 èœå•é¡µæ›¿æ¢èœå“åè§¦å‘åŒæ­¥                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šmenu_screen.dart                                       â”‚
â”‚                                                             â”‚
â”‚ ä¿®æ”¹ _replaceRecipe() å’Œ _deleteRecipe()ï¼š                   â”‚
â”‚                                                             â”‚
â”‚ if (plan.shoppingListId != null) {                          â”‚
â”‚   await shoppingRepo.regenerateFromMealPlan(plan.id);       â”‚
â”‚   showSnackBar('è´­ç‰©æ¸…å•å·²åŒæ­¥æ›´æ–°');                         â”‚
â”‚ }                                                           â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šæ›¿æ¢èœå“åè´­ç‰©æ¸…å•å†…å®¹æ›´æ–°                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### é˜¶æ®µäº”ï¼šæ—¥æœŸç®¡ç†ï¼ˆP1ï¼‰

```
ç›®æ ‡ï¼šæ”¯æŒæŒ‡å®šæ—¥æœŸç”Ÿæˆèœå•ï¼Œæ”¯æŒæ·»åŠ èœè°±åˆ°æŒ‡å®šæ—¥æœŸ
é¢„è®¡ï¼š2 å¤©
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5.1 èœå•ç”Ÿæˆæ·»åŠ æ—¥æœŸé€‰æ‹©å™¨                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šgenerate_menu_screen.dart, menu_provider.dart          â”‚
â”‚                                                             â”‚
â”‚ 1. MenuGenerateState æ·»åŠ  startDate å­—æ®µ                     â”‚
â”‚ 2. UI æ·»åŠ æ—¥æœŸé€‰æ‹©å™¨                                         â”‚
â”‚ 3. saveMenuPlan() ä½¿ç”¨ startDate                            â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šå¯é€‰æ‹©æœªæ¥æ—¥æœŸï¼Œèœå•ä»è¯¥æ—¥æœŸå¼€å§‹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5.2 èœè°±è¯¦æƒ…"æ·»åŠ åˆ°èœå•"åŠŸèƒ½                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šrecipe_detail_screen.dart                              â”‚
â”‚      æ–°å»º add_to_menu_sheet.dart                            â”‚
â”‚      meal_plan_repository.dart                              â”‚
â”‚                                                             â”‚
â”‚ 1. èœè°±è¯¦æƒ…é¡µæ·»åŠ "æ·»åŠ åˆ°èœå•"æŒ‰é’®                             â”‚
â”‚ 2. å¼¹å‡ºæ—¥æœŸ+é¤æ¬¡é€‰æ‹© BottomSheet                             â”‚
â”‚ 3. Repository æ·»åŠ  addRecipeToDate() æ–¹æ³•                   â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šèœè°±å¯æ·»åŠ åˆ°æŒ‡å®šæ—¥æœŸçš„æŒ‡å®šé¤æ¬¡                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### é˜¶æ®µå…­ï¼šäººç¾¤ç»†åˆ†ï¼ˆP1ï¼‰

```
ç›®æ ‡ï¼šæ”¯æŒæ›´ç²¾ç»†çš„ç”¨æˆ·ç±»å‹
é¢„è®¡ï¼š2 å¤©
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6.1 æ‰©å±•é¥®é£Ÿé€‰é¡¹                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šdietary_options.dart                                   â”‚
â”‚                                                             â”‚
â”‚ æ–°å¢é€‰é¡¹ï¼š                                                   â”‚
â”‚ - å¥èº«ç›®æ ‡ç»†åˆ†ï¼ˆå‡è„‚/å¢è‚Œå¼ºåº¦ï¼‰                               â”‚
â”‚ - å­•æœŸé˜¶æ®µï¼ˆæ—©/ä¸­/æ™šæœŸï¼‰                                     â”‚
â”‚ - ç‰¹æ®Šç–¾ç—…ï¼ˆè‚¾ç—…ã€ç—›é£ã€èƒƒç—…ç­‰ï¼‰                              â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šé€‰é¡¹åœ¨å®¶åº­æˆå‘˜ç¼–è¾‘é¡µæ˜¾ç¤º                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6.2 AI Prompt å¢å¼º                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šai_service.dart                                        â”‚
â”‚                                                             â”‚
â”‚ ä¿®æ”¹ _buildFamilyInfo()ï¼š                                    â”‚
â”‚ - æ·»åŠ å…·ä½“é¥®é£ŸæŒ‡å—                                           â”‚
â”‚ - æ·»åŠ è¥å…»é™åˆ¶ä¿¡æ¯                                           â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šAI ç”Ÿæˆçš„èœå•ç¬¦åˆç”¨æˆ·å¥åº·éœ€æ±‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### é˜¶æ®µä¸ƒï¼šä½“éªŒä¼˜åŒ–ï¼ˆP2ï¼‰

```
ç›®æ ‡ï¼šå®Œå–„ç»†èŠ‚ä½“éªŒ
é¢„è®¡ï¼š1 å¤©
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7.1 èœå•-è´­ç‰©æ¸…å•åŒå‘è·³è½¬                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šmenu_screen.dart, shopping_list_screen.dart            â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šèœå•é¡µå¯è·³è½¬è´­ç‰©æ¸…å•ï¼Œåä¹‹äº¦ç„¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7.2 è´­ç‰©æ¸…å•åº“å­˜æç¤º                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ï¼šshopping_list_screen.dart                              â”‚
â”‚                                                             â”‚
â”‚ éªŒè¯ï¼šè´­ç‰©é¡¹æ˜¾ç¤º"å®¶é‡Œè¿˜æœ‰ xxx"æç¤º                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€éªŒè¯æ¸…å•

### æµç¨‹é—­ç¯
- [ ] æ‰“å¼€ App è‡ªåŠ¨æ˜¾ç¤ºå·²ç¡®è®¤èœå•ï¼ˆå¦‚æœæœ‰ï¼‰
- [ ] æ ¹æ®å½“å‰æ—¶é—´é«˜äº®å¯¹åº”é¤æ¬¡ï¼ˆæ—©/åˆ/æ™šï¼‰
- [ ] æ— èœå•æ—¶æ˜¾ç¤ºç”Ÿæˆæ¨èç•Œé¢
- [ ] ä¿å­˜èœå•åï¼Œèœå•å†å²é¡µé¢è‡ªåŠ¨åˆ·æ–°
- [ ] æ¨èé¡µä¿å­˜åå¯é€‰æ‹©ç”Ÿæˆè´­ç‰©æ¸…å•
- [ ] è´­ç‰©æ¸…å•å†…å®¹ä¸æ¨èèœå“ä¸€è‡´
- [ ] æ›¿æ¢èœå“åè´­ç‰©æ¸…å•è‡ªåŠ¨æ›´æ–°
- [ ] åˆ é™¤èœå“åè´­ç‰©æ¸…å•åŒæ­¥åˆ é™¤é£Ÿæ

### æ—¥æœŸç®¡ç†
- [ ] å¯é€‰æ‹©æœªæ¥æ—¥æœŸä½œä¸ºèœå•å¼€å§‹æ—¥æœŸ
- [ ] èœè°±è¯¦æƒ…å¯æ·»åŠ åˆ°æŒ‡å®šæ—¥æœŸå’Œé¤æ¬¡
- [ ] æ·»åŠ åèœå•æ­£ç¡®æ˜¾ç¤º

### äººç¾¤æœåŠ¡
- [ ] å¥èº«ç›®æ ‡å¯é€‰æ‹©å‡è„‚/å¢è‚Œå¼ºåº¦
- [ ] å­•æœŸå¯é€‰æ‹©å…·ä½“é˜¶æ®µ
- [ ] æ–°å¢å¥åº·çŠ¶å†µé€‰é¡¹å¯æ­£å¸¸ä½¿ç”¨
- [ ] AI æ¨èè€ƒè™‘å…·ä½“è¥å…»éœ€æ±‚

### ä½“éªŒä¼˜åŒ–
- [ ] èœå•é¡µå¯è·³è½¬å…³è”è´­ç‰©æ¸…å•
- [ ] è´­ç‰©æ¸…å•å¯è·³è½¬å…³è”èœå•
- [ ] è´­ç‰©é¡¹æ˜¾ç¤ºåº“å­˜æç¤º

---

## å…«ã€å…³é”®æ–‡ä»¶æ¸…å•

| åŠŸèƒ½æ¨¡å— | æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ |
|----------|----------|----------|
| æ¨èæµç¨‹ | `lib/features/recommend/presentation/providers/recommend_provider.dart` | ä¿®æ”¹ |
| æ¨èæµç¨‹ | `lib/features/recommend/presentation/screens/recommend_screen.dart` | ä¿®æ”¹ |
| èœå•ç®¡ç† | `lib/features/menu/presentation/screens/menu_screen.dart` | ä¿®æ”¹ |
| èœå•ç®¡ç† | `lib/features/menu/presentation/screens/generate_menu_screen.dart` | ä¿®æ”¹ |
| èœå•ç®¡ç† | `lib/features/menu/presentation/providers/menu_provider.dart` | ä¿®æ”¹ |
| èœå•ç®¡ç† | `lib/features/menu/data/repositories/meal_plan_repository.dart` | ä¿®æ”¹ |
| è´­ç‰©æ¸…å• | `lib/features/shopping/data/repositories/shopping_list_repository.dart` | ä¿®æ”¹ |
| è´­ç‰©æ¸…å• | `lib/features/shopping/presentation/screens/shopping_list_screen.dart` | ä¿®æ”¹ |
| èœè°±è¯¦æƒ… | `lib/features/recipe/presentation/screens/recipe_detail_screen.dart` | ä¿®æ”¹ |
| é¥®é£Ÿé€‰é¡¹ | `lib/features/family/data/models/dietary_options.dart` | ä¿®æ”¹ |
| å®¶åº­ç¼–è¾‘ | `lib/features/family/presentation/screens/family_detail_screen.dart` | ä¿®æ”¹ |
| AI æœåŠ¡ | `lib/core/services/ai_service.dart` | ä¿®æ”¹ |
| æ–°å¢ç»„ä»¶ | `lib/features/menu/presentation/widgets/add_to_menu_sheet.dart` | æ–°å»º |
| æ–°å¢æ¨¡å‹ | `lib/features/family/data/models/nutrition_target.dart` | æ–°å»º |

---

## ä¹ã€é£é™©ä¸æ³¨æ„äº‹é¡¹

1. **æ•°æ®è¿ç§»**ï¼šæ–°å¢çš„å¥åº·çŠ¶å†µé€‰é¡¹éœ€è¦è€ƒè™‘ä¸ç°æœ‰æ•°æ®çš„å…¼å®¹æ€§
2. **AI æˆæœ¬**ï¼šæ›´è¯¦ç»†çš„ Prompt å¯èƒ½å¢åŠ  token æ¶ˆè€—
3. **ç”¨æˆ·æ•™è‚²**ï¼šæ–°åŠŸèƒ½éœ€è¦é€‚å½“çš„å¼•å¯¼æç¤º
4. **æµ‹è¯•è¦†ç›–**ï¼šæµç¨‹é—­ç¯æ¶‰åŠå¤šä¸ªæ¨¡å—è”åŠ¨ï¼Œéœ€è¦ç«¯åˆ°ç«¯æµ‹è¯•

---

## åã€åç»­ç‰ˆæœ¬æ‰©å±•æ€§è€ƒè™‘

### 10.1 æ¶æ„è®¾è®¡åŸåˆ™

```
v1.2 è®¾è®¡æ—¶éœ€è¦ä¸ºåç»­ç‰ˆæœ¬é¢„ç•™æ‰©å±•ç‚¹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      v1.3+ è§„åˆ’                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç”¨æˆ·æ³¨å†Œ/ç™»å½•                                              â”‚
â”‚ â€¢ è®¢é˜…ä¼šå‘˜ç³»ç»Ÿ                                               â”‚
â”‚ â€¢ æœ¬åœ°æ•°æ®äº‘åŒæ­¥                                             â”‚
â”‚ â€¢ å¤šè®¾å¤‡æ•°æ®åŒæ­¥                                             â”‚
â”‚ â€¢ ç¤¾äº¤åˆ†äº«                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 æ•°æ®æ¨¡å‹æ‰©å±•é¢„ç•™

**ç°æœ‰æ¨¡å‹æ·»åŠ å­—æ®µé¢„ç•™**ï¼ˆv1.2 ä¸å®ç°ï¼Œä½†è®¾è®¡æ—¶è€ƒè™‘ï¼‰ï¼š

```dart
// âš ï¸ ä»¥ä¸‹å­—æ®µåœ¨ v1.2 ä¸æ·»åŠ ï¼Œä½†ä»£ç è®¾è®¡ä¸åº”é˜»ç¢åç»­æ·»åŠ 

// ç”¨æˆ·æ¨¡å‹ï¼ˆv1.3 æ–°å¢ï¼‰
class UserModel {
  String id;
  String? email;
  String? phone;
  String? avatarUrl;
  DateTime createdAt;
  DateTime? lastLoginAt;
  SubscriptionTier tier;  // free / premium / family
}

// å®¶åº­æ¨¡å‹æ‰©å±•
class FamilyModel {
  // ç°æœ‰å­—æ®µ...

  // v1.3 æ‰©å±•å­—æ®µ
  String? ownerId;           // åˆ›å»ºè€…ç”¨æˆ· ID
  List<String>? memberIds;   // å®¶åº­æˆå‘˜ç”¨æˆ· ID
  String? syncStatus;        // local / syncing / synced
  DateTime? lastSyncAt;      // æœ€ååŒæ­¥æ—¶é—´
  String? cloudId;           // äº‘ç«¯ IDï¼ˆç”¨äºåŒæ­¥ï¼‰
}

// èœå•æ¨¡å‹æ‰©å±•
class MealPlanModel {
  // ç°æœ‰å­—æ®µ...

  // v1.3 æ‰©å±•å­—æ®µ
  String? cloudId;
  DateTime? lastSyncAt;
  String? syncStatus;
}

// èœè°±æ¨¡å‹æ‰©å±•
class RecipeModel {
  // ç°æœ‰å­—æ®µ...

  // v1.3 æ‰©å±•å­—æ®µ
  String? cloudId;
  String? authorId;          // åˆ›å»ºè€…
  bool isPublic;             // æ˜¯å¦å…¬å¼€åˆ†äº«
  int? likeCount;            // æ”¶è—æ•°
}
```

### 10.3 v1.2 ä»£ç è®¾è®¡è§„èŒƒ

ä¸ºä¿è¯åç»­æ‰©å±•é¡ºåˆ©ï¼Œv1.2 å¼€å‘éœ€éµå¾ªï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§„èŒƒ 1ï¼šRepository å±‚æŠ½è±¡                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰€æœ‰æ•°æ®è®¿é—®é€šè¿‡ Repositoryï¼Œä¸ç›´æ¥æ“ä½œ Hive                  â”‚
â”‚                                                             â”‚
â”‚ âœ… æ­£ç¡®ï¼š                                                    â”‚
â”‚ await mealPlanRepository.saveMealPlan(plan);                â”‚
â”‚                                                             â”‚
â”‚ âŒ é”™è¯¯ï¼š                                                    â”‚
â”‚ await Hive.box('mealPlans').put(plan.id, plan);             â”‚
â”‚                                                             â”‚
â”‚ åŸå› ï¼šåç»­äº‘åŒæ­¥æ—¶ï¼ŒRepository å¯ç»Ÿä¸€å¤„ç†æœ¬åœ°+äº‘ç«¯å­˜å‚¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§„èŒƒ 2ï¼šID ç”Ÿæˆä½¿ç”¨ UUID                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰€æœ‰å®ä½“ ID ä½¿ç”¨ UUIDï¼Œä¸ä½¿ç”¨è‡ªå¢ ID                          â”‚
â”‚                                                             â”‚
â”‚ âœ… æ­£ç¡®ï¼š                                                    â”‚
â”‚ final id = const Uuid().v4();                               â”‚
â”‚                                                             â”‚
â”‚ âŒ é”™è¯¯ï¼š                                                    â”‚
â”‚ final id = DateTime.now().millisecondsSinceEpoch.toString();â”‚
â”‚                                                             â”‚
â”‚ åŸå› ï¼šUUID ä¿è¯å¤šè®¾å¤‡åŒæ­¥æ—¶ ID ä¸å†²çª                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§„èŒƒ 3ï¼šæ—¶é—´æˆ³ä½¿ç”¨ UTC                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰€æœ‰æ—¶é—´å­—æ®µå­˜å‚¨ UTC æ—¶é—´                                    â”‚
â”‚                                                             â”‚
â”‚ âœ… æ­£ç¡®ï¼š                                                    â”‚
â”‚ createdAt: DateTime.now().toUtc()                           â”‚
â”‚                                                             â”‚
â”‚ âŒ é”™è¯¯ï¼š                                                    â”‚
â”‚ createdAt: DateTime.now()                                   â”‚
â”‚                                                             â”‚
â”‚ åŸå› ï¼šäº‘åŒæ­¥æ—¶ä¸åŒæ—¶åŒºè®¾å¤‡æ•°æ®ä¸€è‡´æ€§                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§„èŒƒ 4ï¼šæ¨¡å‹æ·»åŠ  updatedAt å­—æ®µ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…³é”®æ¨¡å‹æ·»åŠ  updatedAt å­—æ®µï¼Œæ¯æ¬¡ä¿®æ”¹æ—¶æ›´æ–°                   â”‚
â”‚                                                             â”‚
â”‚ å½±å“æ¨¡å‹ï¼š                                                   â”‚
â”‚ - FamilyModel                                               â”‚
â”‚ - MealPlanModel                                             â”‚
â”‚ - RecipeModel                                               â”‚
â”‚ - ShoppingListModel                                         â”‚
â”‚                                                             â”‚
â”‚ åŸå› ï¼šäº‘åŒæ­¥æ—¶ç”¨äºå†²çªæ£€æµ‹å’Œå¢é‡åŒæ­¥                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§„èŒƒ 5ï¼šæ•æ„Ÿé…ç½®ä¸ç¡¬ç¼–ç                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API å¯†é’¥ã€æœåŠ¡ç«¯åœ°å€ç­‰é…ç½®ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶              â”‚
â”‚                                                             â”‚
â”‚ âœ… æ­£ç¡®ï¼š                                                    â”‚
â”‚ final apiKey = const String.fromEnvironment('API_KEY');     â”‚
â”‚                                                             â”‚
â”‚ âŒ é”™è¯¯ï¼š                                                    â”‚
â”‚ final apiKey = 'sk-xxxx...';                                â”‚
â”‚                                                             â”‚
â”‚ åŸå› ï¼šåç»­æ¥å…¥äº‘æœåŠ¡æ—¶æ–¹ä¾¿åˆ‡æ¢ç¯å¢ƒ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.4 äº‘åŒæ­¥æ¶æ„é¢„è§ˆï¼ˆv1.3ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    v1.3 äº‘åŒæ­¥æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è®¾å¤‡ A  â”‚    â”‚ è®¾å¤‡ B  â”‚    â”‚      äº‘ç«¯æœåŠ¡            â”‚ â”‚
â”‚  â”‚         â”‚    â”‚         â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚ Hive    â”‚â†â”€â”€â†’â”‚ Hive    â”‚â†â”€â”€â†’â”‚  â”‚  ç”¨æˆ·æ•°æ®åº“         â”‚â”‚ â”‚
â”‚  â”‚ æœ¬åœ°å­˜å‚¨ â”‚    â”‚ æœ¬åœ°å­˜å‚¨ â”‚    â”‚  â”‚  (Supabase/Firebase)â”‚â”‚ â”‚
â”‚  â”‚         â”‚    â”‚         â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â†‘              â†‘                    â†‘                â”‚
â”‚       â”‚              â”‚                    â”‚                â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                      â”‚                                      â”‚
â”‚              SyncServiceï¼ˆv1.3 æ–°å¢ï¼‰                        â”‚
â”‚              â”œâ”€â”€ å¢é‡åŒæ­¥                                    â”‚
â”‚              â”œâ”€â”€ å†²çªè§£å†³                                    â”‚
â”‚              â”œâ”€â”€ ç¦»çº¿é˜Ÿåˆ—                                    â”‚
â”‚              â””â”€â”€ åå°åŒæ­¥                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.5 è®¢é˜…ä¼šå‘˜åŠŸèƒ½é¢„è§ˆï¼ˆv1.3ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¼šå‘˜ç­‰çº§è®¾è®¡                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å…è´¹ç‰ˆ                     é«˜çº§ç‰ˆ                å®¶åº­ç‰ˆ     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â€¢ åŸºç¡€æ¨è                 â€¢ æ‰€æœ‰å…è´¹åŠŸèƒ½        â€¢ æ‰€æœ‰é«˜çº§  â”‚
â”‚  â€¢ 1ä¸ªå®¶åº­                  â€¢ æ— é™å®¶åº­            â€¢ 5ä¸ªè´¦å·   â”‚
â”‚  â€¢ 7å¤©èœå•                  â€¢ 30å¤©èœå•            â€¢ æ•°æ®å…±äº«  â”‚
â”‚  â€¢ æœ¬åœ°å­˜å‚¨                 â€¢ äº‘åŒæ­¥              â€¢ åä½œç¼–è¾‘  â”‚
â”‚  â€¢ åŸºç¡€è¯­éŸ³                 â€¢ é«˜çº§è¯­éŸ³            â€¢ ä¼˜å…ˆæ”¯æŒ  â”‚
â”‚                             â€¢ è¥å…»åˆ†æ                       â”‚
â”‚                             â€¢ å¯¼å‡ºåŠŸèƒ½                       â”‚
â”‚                                                             â”‚
â”‚  Â¥0                         Â¥9.9/æœˆ              Â¥19.9/æœˆ   â”‚
â”‚                             Â¥99/å¹´               Â¥199/å¹´    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.6 v1.2 éœ€è¦çš„é¢„ç•™å·¥ä½œ

| é¡¹ç›® | å½“å‰çŠ¶æ€ | v1.2 éœ€è¦åšçš„ |
|------|----------|--------------|
| Repository æŠ½è±¡ | âœ… å·²æœ‰ | ç¡®ä¿æ–°ä»£ç éµå¾ª |
| UUID ä½œä¸º ID | âœ… å·²ä½¿ç”¨ | ç¡®ä¿æ–°ä»£ç éµå¾ª |
| updatedAt å­—æ®µ | âš ï¸ éƒ¨åˆ†æœ‰ | æ£€æŸ¥å¹¶è¡¥å…… |
| UTC æ—¶é—´ | âš ï¸ ä¸ç¡®å®š | æ£€æŸ¥å¹¶ä¿®æ­£ |
| ç¯å¢ƒå˜é‡é…ç½® | âœ… å·²æœ‰ | ç¡®ä¿æ–°ä»£ç éµå¾ª |

---

## åä¸€ã€å®æ–½æ£€æŸ¥æ¸…å•

### å¼€å‘å‰æ£€æŸ¥
- [ ] ç†Ÿæ‚‰ç°æœ‰ä»£ç ç»“æ„
- [ ] ç¡®è®¤ Hive TypeId åˆ†é…ï¼ˆé¿å…å†²çªï¼‰
- [ ] ç¡®è®¤ç¯å¢ƒé…ç½®æ­£ç¡®

### æ¯ä¸ª Step å®Œæˆåæ£€æŸ¥
- [ ] ä»£ç ç¼–è¯‘é€šè¿‡
- [ ] æ–°å¢åŠŸèƒ½æ‰‹åŠ¨æµ‹è¯•é€šè¿‡
- [ ] ä¸å½±å“ç°æœ‰åŠŸèƒ½
- [ ] éµå¾ªæ‰©å±•æ€§è®¾è®¡è§„èŒƒ
- [ ] æäº¤ Git commit

### é˜¶æ®µå®Œæˆåæ£€æŸ¥
- [ ] æ‰€æœ‰éªŒè¯ç‚¹é€šè¿‡
- [ ] æš—é»‘æ¨¡å¼é€‚é…
- [ ] ä¸åŒå±å¹•å°ºå¯¸é€‚é…
- [ ] æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™

### å…¨éƒ¨å®Œæˆåæ£€æŸ¥
- [ ] å®Œæ•´ç”¨æˆ·æµç¨‹èµ°é€š
- [ ] è¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] ä»£ç  Review
- [ ] æ›´æ–° CLAUDE.md æ–‡æ¡£
