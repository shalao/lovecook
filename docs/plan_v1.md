# Love Cook V1 产品计划

## 产品核心定位

```
用户痛点：今天吃什么？→ 选择困难症
产品价值：给你推荐，帮你决定
```

**核心理念**：用户需要的是**菜谱灵感**，而不是**库存管理系统**

---

## 功能优先级

| 优先级 | 功能 | 定位 |
|--------|------|------|
| **核心** | 智能推荐 | 基于口味+家庭结构推荐菜品 |
| **核心** | 菜谱详情 | 告诉用户怎么做 |
| **核心** | 收藏功能 | 保存喜欢的菜谱 |
| 辅助 | 购物清单 | 方便超市采购（可选） |
| 辅助 | 库存管理 | 有就参考，没有也行 |

---

## 用户流程设计

### 主流程：今天吃什么？

```
打开App
    ↓
首页直接显示：今日推荐
├── 早餐：小米粥 + 煎蛋
├── 午餐：番茄炒蛋、清炒西兰花
└── 晚餐：红烧排骨、蒜蓉菠菜
    ↓
不喜欢？→ [换一批] 一键刷新
    ↓
点击菜品 → 查看菜谱 → 开始做饭
```

**无需任何前置操作**，打开就能用。

### 推荐算法依据

| 维度 | 来源 | 权重 |
|------|------|------|
| 家庭结构 | 成员年龄（儿童/老人/孕妇） | 高 |
| 健康需求 | 控糖/减脂/高蛋白 | 高 |
| 口味偏好 | 用户设置 + 收藏历史 | 高 |
| 季节时令 | 系统自动判断 | 中 |
| 烹饪难度 | 用户偏好（快手/精细） | 中 |
| 库存食材 | 如果录入了，优先推荐 | 低（可选加成） |

---

## 库存功能重新定位

### 核心理念

```
库存不是为了"记账"
库存是为了"购物时知道家里还有什么"
```

### 库存放在购物模块

```
购物 Tab
├── 购物清单（主）
│   └── 根据推荐菜单生成的采购项
│
└── 家中库存（次）
    ├── 查看现有库存
    ├── 拍照更新库存
    └── 一键下单（未来扩展）
```

### 库存更新流程（拍照模式）

```
用户拍照冰箱/储物柜
        ↓
系统识别出食材列表
        ↓
┌─────────────────────────────┐
│ 检测到的食材                 │
├─────────────────────────────┤
│ ✓ 鸡蛋 ×6                   │
│ ✓ 西红柿 ×3                 │
│ ✓ 牛奶 1盒                  │
│ ✓ 豆腐 1块                  │
├─────────────────────────────┤
│ ⚠️ 之前有，现在没检测到：     │
│ ☐ 青菜（已用完？）           │
│ ☐ 排骨（已用完？）           │
├─────────────────────────────┤
│ [确认更新库存]               │
└─────────────────────────────┘
```

用户只需确认"哪些没了"，而不是逐一录入。

### 库存的新定位

```
之前：必须录入库存 → 才能生成菜单
现在：直接推荐菜单 → 库存只是"加分项"
```

| 场景 | 体验 |
|------|------|
| 没录库存 | 正常推荐，完全可用 |
| 录了库存 | 推荐时显示"✓ 食材齐全"或"需购买：豆腐" |

**库存变成提示信息，而非前置条件**

---

## 购物清单重新定位

```
之前：勾选 → 确认入库 → 库存增加（强制流程）
现在：生成清单 → 超市参考用 → 想更新就拍个照（可选）
```

| 操作 | 之前 | 优化后 |
|------|------|--------|
| 生成清单 | 必须有菜单 | 可手动添加任意物品 |
| 勾选 | 强制（为了入库） | 可选（方便核对） |
| 入库 | 必须操作 | 删除此功能 |

---

## 页面结构设计

### 底部导航（4个Tab）

```
[ 🏠 推荐 ] [ ❤️ 收藏 ] [ 🛒 购物 ] [ 👤 我的 ]
```

| 之前 | 优化后 |
|------|--------|
| 首页、库存、菜单、菜谱、购物、设置（6个） | 推荐、收藏、购物、我的（4个） |

### 首页（推荐Tab）

```
┌─────────────────────────────┐
│  👋 今天想吃点什么？         │
├─────────────────────────────┤
│  🌅 早餐推荐                 │
│  ┌─────┐ ┌─────┐            │
│  │小米粥│ │煎蛋 │  [换一换]  │
│  └─────┘ └─────┘            │
├─────────────────────────────┤
│  ☀️ 午餐推荐                 │
│  ┌─────┐ ┌─────┐            │
│  │番茄蛋│ │西兰花│  [换一换]  │
│  └─────┘ └─────┘            │
├─────────────────────────────┤
│  🌙 晚餐推荐                 │
│  ┌─────┐ ┌─────┐            │
│  │红烧肉│ │蒜蓉菜│  [换一换]  │
│  └─────┘ └─────┘            │
├─────────────────────────────┤
│  [🛒 生成购物清单]           │
└─────────────────────────────┘
```

### 菜品卡片信息

```
┌──────────────────┐
│ 🍅 番茄炒蛋       │
│ 15分钟 · 简单     │
│ ✓ 食材齐全       │  ← 有库存时显示
│ 或               │
│ 需买：鸡蛋×3     │  ← 库存不足时提示
└──────────────────┘
```

### 购物模块

```
┌─────────────────────────────┐
│ 🛒 购物                      │
├─────────────────────────────┤
│ [购物清单] [家中库存]  ← 切换 │
├─────────────────────────────┤
│                             │
│  购物清单视图：              │
│  ┌─────────────────────┐    │
│  │ 🥬 蔬菜               │    │
│  │   ☐ 西兰花 500g      │    │
│  │   ☐ 菠菜 1把         │    │
│  ├─────────────────────┤    │
│  │ 🥩 肉类               │    │
│  │   ☐ 排骨 500g        │    │
│  │   ✓ 鸡蛋 (家里有6个)  │ ← 库存提示 │
│  └─────────────────────┘    │
│                             │
│  [🛍️ 一键下单] (未来扩展)    │
│                             │
└─────────────────────────────┘
```

### 家中库存视图

```
┌─────────────────────────────┐
│ 🛒 购物                      │
├─────────────────────────────┤
│ [购物清单] [家中库存]        │
├─────────────────────────────┤
│                             │
│  🏠 家里还有：               │
│  ┌─────────────────────┐    │
│  │ 鸡蛋 ×6    [×]       │    │
│  │ 牛奶 1盒   [×]       │    │
│  │ 西红柿 ×3  [×]       │    │
│  └─────────────────────┘    │
│                             │
│  [📷 拍照更新库存]           │
│  [✏️ 手动添加]               │
│                             │
└─────────────────────────────┘
```

### "我的"页面

```
我的
├── 家庭管理（成员、口味、健康状况）
├── 菜单历史
├── 设置（语言、API等）
└── 关于
```

---

## 购物清单与库存的联动

### 智能提示（非强制）

| 场景 | 提示 |
|------|------|
| 库存有该食材 | ✓ 家里有，显示灰色 |
| 库存不足 | 需要买 500g（家里还有 200g） |
| 库存没有 | 正常显示 |

### 不强制任何操作

```
之前：购物 → 勾选 → 入库 → 库存增加（强制流程）
现在：购物 → 回家 → 想更新就拍个照（可选）
```

---

## 需要修改的内容

### 删除/弱化

- ❌ 删除"确认入库"强制功能
- ❌ 删除"完成烹饪"扣库存功能
- ⬇️ 库存从主Tab移到"购物"子页面
- ⬇️ 菜单历史从主Tab移到"我的"子页面

### 新增/强化

- ✅ 首页改为"今日推荐"
- ✅ 添加"换一换"按钮
- ✅ 菜品卡片显示库存状态（友好提示）
- ✅ 简化购物清单（只做记录，不强制操作）
- ✅ 库存放在购物模块内，拍照更新

---

## 未来扩展：一键下单

```
购物清单
    ↓
选择平台：美团买菜 / 叮咚买菜 / 盒马
    ↓
一键添加到购物车
    ↓
跳转到对应App完成支付
```

---

## 验证清单

- [ ] 首次打开App，无需任何设置即可看到推荐
- [ ] 点击"换一换"能刷新推荐
- [ ] 不录入库存也能正常使用
- [ ] 录入库存后，推荐会显示"食材齐全"提示
- [ ] 购物清单可以随意勾选，无强制操作
- [ ] 库存在购物模块内可查看和更新
- [ ] 拍照能更新库存，对比显示"没了"的食材

---

## 技术实现要点

### 路由调整

```dart
// 新的底部导航
enum AppTab { recommend, favorites, shopping, profile }

// 购物模块内部Tab
enum ShoppingTab { list, inventory }
```

### 首页推荐Provider

```dart
// 推荐状态
class RecommendState {
  final List<MealRecommend> breakfast;
  final List<MealRecommend> lunch;
  final List<MealRecommend> dinner;
  final bool isLoading;
}

// 刷新单个餐次
Future<void> refreshMeal(String mealType);

// 刷新全部
Future<void> refreshAll();
```

### 库存提示逻辑

```dart
// 菜品卡片显示库存状态
Widget buildInventoryHint(RecipeModel recipe, List<IngredientModel> inventory) {
  final missing = recipe.ingredients
      .where((ing) => !inventory.any((inv) => inv.name == ing.name))
      .toList();

  if (missing.isEmpty) {
    return Text('✓ 食材齐全', style: TextStyle(color: Colors.green));
  } else {
    return Text('需买：${missing.map((m) => m.name).join("、")}');
  }
}
```

---

## 关键文件清单

| 功能 | 文件路径 | 操作 |
|------|----------|------|
| 底部导航 | `lib/app/router.dart` | 修改为4个Tab |
| 首页推荐 | `lib/features/recommend/` | 新建模块 |
| 购物模块 | `lib/features/shopping/` | 重构，添加库存子Tab |
| 库存移动 | `lib/features/inventory/` | 移到购物模块内 |
| 菜品卡片 | `lib/features/recipe/presentation/widgets/` | 添加库存提示 |

---

## 实施阶段

### 阶段一：核心体验（优先）
1. 首页改为"今日推荐"
2. 添加"换一换"功能
3. 底部导航改为4个Tab

### 阶段二：购物模块重构
4. 购物模块添加"家中库存"子Tab
5. 库存从主Tab移除
6. 删除强制入库流程

### 阶段三：智能提示
7. 菜品卡片显示库存状态
8. 购物清单显示"家里有"提示

### 阶段四：拍照更新
9. 库存拍照更新功能
10. 对比显示"没了"的食材
